databases:
  - name: algotrading-backend
    plan: free

services:
  - type: web
    plan: free
    name: algotrading-backend
    runtime: python-3.11
    buildCommand: "pip install --upgrade pip && pip install psycopg[binary]==3.2.9 && pip install -r backend/requirements-prod.txt && cd backend && python test_db_connection.py && python manage.py migrate --noinput"
    startCommand: "ls -la scripts/ && chmod +x scripts/chrome-setup.sh && bash scripts/chrome-setup.sh && cd backend && python -m gunicorn money_multiplier.wsgi:application --bind 0.0.0.0:$PORT"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: algotrading-backend
          property: connectionString
      - key: DB_HOST
        value: "dpg-d26hggjuibrs739ss0h0-a.oregon-postgres.render.com"
      - key: DB_PORT
        value: "5432"
      - key: DB_NAME
        value: "algotrading_60j3"
      - key: DB_USER
        value: "algotrading_user"
      - key: DB_PASSWORD
        value: "KaVpfEyKnvm5g4buBl5tuizkvqoNYJ1x"
      - key: SECRET_KEY
        generateValue: true
      - key: WEB_CONCURRENCY
        value: 4
      - key: DJANGO_SETTINGS_MODULE
        value: "money_multiplier.settings"
      - key: DEBUG
        value: "False"
      - key: ENVIRONMENT
        value: "production"
      - key: ALLOWED_HOSTS
        value: ".onrender.com,algotrading-backend.onrender.com,algotrading-frontend.onrender.com,localhost,127.0.0.1"
      - key: CORS_ALLOWED_ORIGINS
        value: "https://algotrading-frontend.onrender.com,http://localhost:3000,http://localhost:5173"
    buildpacks:
      - heroku/google-chrome
      - heroku/chromedriver

# services:
#   # Django Backend API with SQLite
#   - type: web
#     name: algotrading-backend
#     env: python
#     plan: free
#     region: oregon
#     runtime: python-3.11
#     rootDir: backend
#     buildCommand: |
#       pip install --upgrade pip
#       pip install --prefer-binary --no-cache-dir --only-binary=pandas,numpy,scipy -r requirements.txt
#       export PYTHONPATH=$PYTHONPATH:/opt/render/project/src/backend
#       export DJANGO_SETTINGS_MODULE=money_multiplier.settings
#       python manage.py migrate
#       python manage.py collectstatic --noinput --clear
#     startCommand: "PYTHONPATH=/opt/render/project/src/backend gunicorn money_multiplier.wsgi:application --bind 0.0.0.0:$PORT --workers 2"
#     healthCheckPath: "/api/health/"
#     envVars:
#       - key: DJANGO_SECRET_KEY
#         generateValue: true
#       - key: SECRET_KEY
#         generateValue: true
#       - key: DEBUG
#         value: "False"
#       - key: DJANGO_SETTINGS_MODULE
#         value: "money_multiplier.settings"
#       - key: PYTHONPATH
#         value: "/opt/render/project/src/backend"
#       - key: ALLOWED_HOSTS
#         value: ".onrender.com,algotrading-backend.onrender.com,localhost,127.0.0.1"
#       - key: CORS_ALLOWED_ORIGINS
#         value: "https://algotrading-frontend.onrender.com,http://localhost:3000,http://localhost:5173"

#   # React Frontend (Static Site)
#   - type: web
#     name: algotrading-frontend
#     env: static
#     rootDir: frontend
#     buildCommand: |
#       npm ci
#       npm run build:render
#     staticPublishPath: dist
#     routes:
#       - type: rewrite
#         source: /*
#         destination: /index.html
#     envVars:
#       - key: VITE_API_URL
#         value: https://algotrading-backend.onrender.com
